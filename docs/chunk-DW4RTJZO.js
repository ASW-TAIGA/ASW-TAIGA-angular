import{b as re,d as ae,e as se,h as de,j as pe,k as me,q as ce,r as ue,s as _e}from"./chunk-UGDPF2HT.js";import{a as le}from"./chunk-NGVF4NNM.js";import{Aa as j,D as P,Fa as b,H as y,I,J as r,Ja as Z,La as $,Na as ee,O as q,Ra as te,S as u,V as J,W as Q,Wa as ie,Y as m,Ya as ne,Z as D,Za as G,aa as c,ba as O,bb as oe,ca as B,da as l,ea as o,f as w,fa as C,i as R,ia as F,j as L,k as Y,ka as g,la as d,ma as N,na as a,oa as _,pa as E,qa as X,r as S,u as f,v as x,wa as H,xa as V,ya as z}from"./chunk-CUL4UXS2.js";var ge=()=>[$,G],W=(t,i)=>({"border-indigo-500 text-indigo-600":t,"border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300":i}),fe=t=>["/issues",t],xe=(t,i)=>i.id;function Ce(t,i){t&1&&(l(0,"p",1),a(1,"Loading user profile..."),o())}function ve(t,i){if(t&1&&(l(0,"div",2)(1,"strong",4),a(2,"Error:"),o(),a(3),o()),t&2){let e=d();r(3),E(" ",e.pageError()," ")}}function he(t,i){if(t&1&&(l(0,"p",12),a(1),o()),t&2){let e,n=d(2);r(),_((e=n.userForView())==null?null:e.email)}}function be(t,i){if(t&1&&(l(0,"p",18),a(1),o()),t&2){let e,n=d(2);r(),_((e=n.userForView())==null||e.profile==null?null:e.profile.bio)}}function Pe(t,i){t&1&&(l(0,"p",19),a(1,"No bio provided."),o())}function we(t,i){if(t&1){let e=F();l(0,"button",27),g("click",function(){f(e);let s=d(2);return x(s.openEditModal())}),a(1," Edit Profile "),o()}}function Se(t,i){t&1&&(l(0,"p",28),a(1,"No issues found in this section."),o())}function ye(t,i){if(t&1&&C(0,"span",32),t&2){let e=d(5);m("innerHTML",e.currentSortDirection()==="asc"?"\u25B2":"\u25BC",y)}}function Ee(t,i){if(t&1&&C(0,"span",32),t&2){let e=d(5);m("innerHTML",e.currentSortDirection()==="asc"?"\u25B2":"\u25BC",y)}}function Fe(t,i){if(t&1&&C(0,"span",32),t&2){let e=d(5);m("innerHTML",e.currentSortDirection()==="asc"?"\u25B2":"\u25BC",y)}}function Te(t,i){if(t&1&&C(0,"span",32),t&2){let e=d(5);m("innerHTML",e.currentSortDirection()==="asc"?"\u25B2":"\u25BC",y)}}function Ie(t,i){if(t&1&&C(0,"span",32),t&2){let e=d(5);m("innerHTML",e.currentSortDirection()==="asc"?"\u25B2":"\u25BC",y)}}function De(t,i){if(t&1&&(l(0,"tr",35)(1,"td",36)(2,"span",37),a(3),o()(),l(4,"td",36)(5,"span",37),a(6),o()(),l(7,"td",38)(8,"a",39),a(9),o()(),l(10,"td",36),a(11),o(),l(12,"td",36)(13,"span",37),a(14),o()(),l(15,"td",36),a(16),z(17,"date"),o()()),t&2){let e=i.$implicit,n=d(5);r(2),D("background-color",(e.issue_type==null?null:e.issue_type.color)||"#E2E8F0")("color",n.getTextColor(e.issue_type==null?null:e.issue_type.color)),r(),_((e.issue_type==null?null:e.issue_type.name)||"N/A"),r(2),D("background-color",(e.severity==null?null:e.severity.color)||"#E2E8F0")("color",n.getTextColor(e.severity==null?null:e.severity.color)),r(),_((e.severity==null?null:e.severity.name)||"N/A"),r(2),m("routerLink",H(22,fe,e.id)),r(),E("#",e.id,""),r(2),_(e.title),r(2),D("background-color",(e.status==null?null:e.status.color)||"#E2E8F0")("color",n.getTextColor(e.status==null?null:e.status.color)),r(),_((e.status==null?null:e.status.name)||"N/A"),r(2),_(j(17,19,e.updated_at,"shortDate"))}}function Ve(t,i){if(t&1){let e=F();l(0,"table",29)(1,"thead",30)(2,"tr")(3,"th",31),g("click",function(){f(e);let s=d(4);return x(s.applySort("issue_type"))}),a(4," Type "),u(5,ye,1,1,"span",32),o(),l(6,"th",31),g("click",function(){f(e);let s=d(4);return x(s.applySort("severity"))}),a(7," Severity "),u(8,Ee,1,1,"span",32),o(),l(9,"th",31),g("click",function(){f(e);let s=d(4);return x(s.applySort("id"))}),a(10," Issue # "),u(11,Fe,1,1,"span",32),o(),l(12,"th",33),a(13,"Title"),o(),l(14,"th",31),g("click",function(){f(e);let s=d(4);return x(s.applySort("status"))}),a(15," Status "),u(16,Te,1,1,"span",32),o(),l(17,"th",31),g("click",function(){f(e);let s=d(4);return x(s.applySort("updated_at"))}),a(18," Modified "),u(19,Ie,1,1,"span",32),o()()(),l(20,"tbody",34),O(21,De,18,24,"tr",35,xe),o()()}if(t&2){let e=d(4);r(5),c(e.currentSortField()==="issue_type"?5:-1),r(3),c(e.currentSortField()==="severity"?8:-1),r(3),c(e.currentSortField()==="id"?11:-1),r(5),c(e.currentSortField()==="status"?16:-1),r(3),c(e.currentSortField()==="updated_at"?19:-1),r(2),B(e.asIssues(e.tabContent()))}}function Ue(t,i){t&1&&(l(0,"p"),a(1,"Loading issues table..."),o())}function ke(t,i){t&1&&(u(0,Ve,23,5)(1,Ue,2,0),J(2,0,ge,null,1),Q(0,-1))}function Ae(t,i){if(t&1&&u(0,Se,2,0,"p",28)(1,ke,4,0),t&2){let e,n=d(2);c((e=n.tabContent())!=null&&e.length?1:0)}}function Me(t,i){t&1&&(l(0,"p",28),a(1,"This user has not made any comments."),o())}function Re(t,i){if(t&1&&(l(0,"li",41)(1,"p",42),a(2),o(),l(3,"p",15),a(4," on issue "),l(5,"a",43),a(6),o(),a(7),z(8,"date"),o()()),t&2){let e=i.$implicit;r(2),_(e.text),r(3),N("fragment","comment-",e.id,""),m("routerLink",H(9,fe,e.issue)),r(),E("#",e.issue,""),r(),E(" - ",j(8,6,e.created_at,"medium")," ")}}function Le(t,i){if(t&1&&(l(0,"ul",40),O(1,Re,9,11,"li",41,xe),o()),t&2){let e=d(3);r(),B(e.asComments(e.tabContent()))}}function Oe(t,i){if(t&1&&u(0,Me,2,0,"p",28)(1,Le,3,0,"ul",40),t&2){let e,n=d(2);c((e=n.tabContent())!=null&&e.length?1:0)}}function Be(t,i){if(t&1&&C(0,"img",53),t&2){let e=d(3);m("src",e.avatarPreviewUrl,I)}}function Ne(t,i){if(t&1&&C(0,"img",54),t&2){let e=d();m("src",e.profile.avatar_url,I)}}function He(t,i){t&1&&(l(0,"div",55),a(1,"No Avatar"),o())}function ze(t,i){if(t&1){let e=F();l(0,"div",26)(1,"div",44)(2,"h3",45),a(3,"Edit Profile"),o(),l(4,"form",46),g("ngSubmit",function(){f(e);let s=d(2);return x(s.saveProfileChanges())}),l(5,"div",47)(6,"label",48),a(7,"Bio"),o(),C(8,"textarea",49),o(),l(9,"div",50)(10,"label",51),a(11,"Avatar"),o(),l(12,"input",52),g("change",function(s){f(e);let h=d(2);return x(h.onFileSelected(s))}),o(),u(13,Be,1,1,"img",53)(14,Ne,1,1,"img",54)(15,He,2,0,"div",55),o(),l(16,"div",56)(17,"button",57),g("click",function(){f(e);let s=d(2);return x(s.closeEditModal())}),a(18,"Cancel"),o(),l(19,"button",58),a(20),o()()()()()}if(t&2){let e=i,n=d(2);r(4),m("formGroup",n.editProfileForm),r(9),c(n.avatarPreviewUrl?13:e.profile!=null&&e.profile.avatar_url?14:15),r(4),m("disabled",n.isUpdatingProfile()),r(2),m("disabled",n.isUpdatingProfile()||n.editProfileForm.invalid),r(),E(" ",n.isUpdatingProfile()?"Saving...":"Save Changes"," ")}}function je(t,i){if(t&1){let e=F();l(0,"div",5)(1,"div",6)(2,"div",7),C(3,"img",8),l(4,"div",9)(5,"h1",10),a(6),o(),l(7,"p",11),a(8),o(),u(9,he,2,1,"p",12),o(),l(10,"div",13)(11,"div")(12,"p",14),a(13),o(),l(14,"p",15),a(15,"Open Assigned"),o()(),l(16,"div")(17,"p",14),a(18),o(),l(19,"p",15),a(20,"Watched Issues"),o()(),l(21,"div")(22,"p",14),a(23),o(),l(24,"p",15),a(25,"Comments"),o()()(),l(26,"div",16)(27,"h3",17),a(28,"Bio"),o(),u(29,be,2,1,"p",18)(30,Pe,2,0,"p",19)(31,we,2,0,"button",20),o()(),l(32,"div",21)(33,"div",22)(34,"nav",23)(35,"button",24),g("click",function(){f(e);let s=d();return x(s.selectTab("assigned"))}),a(36," Open Assigned Issues "),o(),l(37,"button",24),g("click",function(){f(e);let s=d();return x(s.selectTab("watched"))}),a(38," Watched Issues "),o(),l(39,"button",24),g("click",function(){f(e);let s=d();return x(s.selectTab("comments"))}),a(40," Comments "),o()()(),l(41,"div")(42,"h3",25),a(43),o(),u(44,Ae,2,1)(45,Oe,2,1),o()()()(),u(46,ze,21,5,"div",26)}if(t&2){let e,n,s,h,v,U,k,A,M,K,p=d();r(3),N("alt","",(e=p.userForView())==null?null:e.username,"'s avatar"),m("src",((n=p.userForView())==null||n.profile==null?null:n.profile.avatar_url)||"https://placehold.co/128x128/E2E8F0/718096?text=No+Avatar",I),r(3),X("",((s=p.userForView())==null?null:s.first_name)||""," ",((s=p.userForView())==null?null:s.last_name)||"",""),r(2),_("@"+((h=p.userForView())==null?null:h.username)),r(),c((v=p.userForView())!=null&&v.email&&p.isOwnProfile()?9:-1),r(4),_(((U=p.userForView())==null||U.stats==null?null:U.stats.open_assigned)||0),r(5),_(((k=p.userForView())==null||k.stats==null?null:k.stats.watched)||0),r(5),_(((A=p.userForView())==null||A.stats==null?null:A.stats.comments)||0),r(6),c(!((M=p.userForView())==null||M.profile==null)&&M.profile.bio?29:30),r(2),c(p.isOwnProfile()?31:-1),r(4),m("ngClass",V(19,W,p.activeTabSignal()==="assigned",p.activeTabSignal()!=="assigned")),r(2),m("ngClass",V(22,W,p.activeTabSignal()==="watched",p.activeTabSignal()!=="watched")),r(2),m("ngClass",V(25,W,p.activeTabSignal()==="comments",p.activeTabSignal()!=="comments")),r(4),_(p.listTitle()),r(),c(p.activeTabSignal()==="assigned"||p.activeTabSignal()==="watched"?44:-1),r(),c(p.activeTabSignal()==="comments"?45:-1),r(),c((K=p.showEditModal()&&p.isOwnProfile()&&p.userForView())?46:-1,K)}}function $e(t,i){t&1&&(l(0,"p",3),a(1,"User not found or an error occurred."),o())}var T=class t{route=S(ie);router=S(ne);apiService=S(le);fb=S(ce);authService=S(oe);profileData=P(null);isLoadingPage=P(!0);pageError=P(null);userForView=b(()=>{let i=this.profileData();return i?{id:i.id,username:i.username,first_name:i.first_name,last_name:i.last_name,email:i.email,profile:i.profile,stats:i.stats}:null});tabContent=b(()=>this.profileData()?.tab_content||[]);activeTabSignal=b(()=>this.profileData()?.active_tab||"assigned");listTitle=b(()=>this.profileData()?.list_title||"Content");currentSortField=b(()=>this.profileData()?.current_sort_field||null);currentSortDirection=b(()=>this.profileData()?.current_sort_direction||null);loggedInUsername=b(()=>this.authService.currentUsername());isOwnProfile=P(!1);viewedUsernameFromRoute=null;editProfileForm;selectedAvatarFile=null;isUpdatingProfile=P(!1);avatarPreviewUrl=null;showEditModal=P(!1);constructor(){this.editProfileForm=this.fb.group({bio:[""]})}ngOnInit(){this.route.paramMap.pipe(L(i=>{this.isLoadingPage.set(!0),this.pageError.set(null),this.profileData.set(null);let e=this.route.snapshot.data.ownProfile===!0||this.router.url.endsWith("/profile/me"),n=i.get("username");if(e)this.viewedUsernameFromRoute=this.loggedInUsername(),this.isOwnProfile.set(!0);else if(n)this.viewedUsernameFromRoute=n,this.isOwnProfile.set(this.loggedInUsername()===n);else return this.pageError.set("User identifier not found in route."),this.isLoadingPage.set(!1),w(null);return this.viewedUsernameFromRoute?this.loadProfileData(this.viewedUsernameFromRoute,"assigned"):(this.pageError.set("Cannot determine user profile to load."),this.isLoadingPage.set(!1),w(null))})).subscribe()}loadProfileData(i,e,n){this.isLoadingPage.set(!0);let s=new te().set("tab",e);n&&(s=s.set("sort_by",n));let h=`/profile/${i}/`;return this.apiService.get(h,s).pipe(Y(v=>{this.profileData.set(v),this.isOwnProfile()&&v&&this.editProfileForm.patchValue({bio:v.profile?.bio||""}),this.isLoadingPage.set(!1)}),R(v=>(console.error(`Failed to load profile for ${i}, tab: ${e}`,v),this.pageError.set(`Could not load profile data for ${i}.`),this.isLoadingPage.set(!1),w(null))))}selectTab(i){this.viewedUsernameFromRoute&&this.activeTabSignal()!==i&&this.loadProfileData(this.viewedUsernameFromRoute,i,this.currentSortField()??void 0).subscribe()}applySort(i){if(!this.viewedUsernameFromRoute)return;let e=this.currentSortField(),n=this.currentSortDirection(),s=i.toString();e===i&&(s=(n==="asc"?"-":"")+i),this.loadProfileData(this.viewedUsernameFromRoute,this.activeTabSignal(),s).subscribe()}openEditModal(){let i=this.userForView();i&&this.isOwnProfile()&&(this.editProfileForm.patchValue({bio:i.profile?.bio||""}),this.selectedAvatarFile=null,this.avatarPreviewUrl=i.profile?.avatar_url||null,this.showEditModal.set(!0))}closeEditModal(){this.showEditModal.set(!1)}onFileSelected(i){let e=i.target;if(e.files&&e.files[0]){this.selectedAvatarFile=e.files[0];let n=new FileReader;n.onload=s=>this.avatarPreviewUrl=n.result,n.readAsDataURL(this.selectedAvatarFile)}else this.selectedAvatarFile=null,this.avatarPreviewUrl=this.userForView()?.profile?.avatar_url||null}saveProfileChanges(){if(!this.isOwnProfile()||!this.userForView()||this.editProfileForm.invalid)return;this.isUpdatingProfile.set(!0);let e={profile:{bio:this.editProfileForm.value.bio}};this.apiService.patch("/profile/me/",e).pipe(L(n=>{if(this.profileData.set(n),this.selectedAvatarFile){let s=new FormData;return s.append("profile.avatar",this.selectedAvatarFile,this.selectedAvatarFile.name),this.apiService.patchMultipart("/profile/me/",s)}return w(n)}),R(n=>(console.error("Failed to update profile",n),alert("Error updating profile. Please check console for details."),this.isUpdatingProfile.set(!1),w(null)))).subscribe(n=>{n&&this.profileData.set(n),this.isUpdatingProfile.set(!1),this.closeEditModal(),this.selectedAvatarFile=null})}getTextColor(i){if(!i)return"#000000";try{let e=i.replace("#","");if(e.length!==3&&e.length!==6)return"#000000";let n=parseInt(e.length===3?e.substring(0,1).repeat(2):e.substring(0,2),16),s=parseInt(e.length===3?e.substring(1,2).repeat(2):e.substring(2,4),16),h=parseInt(e.length===3?e.substring(2,3).repeat(2):e.substring(4,6),16);return .2126*n+.7152*s+.0722*h>128?"#000000":"#FFFFFF"}catch{return"#000000"}}asIssues(i){return i?i.length>0&&"title"in i[0]?i:[]:[]}asComments(i){return i?i.length>0&&"text"in i[0]?i:[]:[]}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=q({type:t,selectors:[["app-profile-page"]],decls:5,vars:1,consts:[[1,"container","mx-auto","p-4"],[1,"text-center","text-slate-600","text-lg","py-10"],["role","alert",1,"bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded-md"],[1,"text-center","text-slate-500","py-10"],[1,"font-bold"],[1,"bg-white","shadow-xl","rounded-lg","overflow-hidden"],[1,"md:flex"],[1,"md:w-1/3","p-6","bg-slate-50","border-b","md:border-b-0","md:border-r","border-slate-200","flex","flex-col","items-center","md:items-start"],["onError","this.src='https://placehold.co/128x128/E2E8F0/718096?text=No+Avatar'",1,"w-32","h-32","rounded-full","mb-4","border-4","border-white","shadow-md","object-cover",3,"src","alt"],[1,"text-center","md:text-left","w-full"],[1,"text-2xl","font-bold","text-slate-800"],[1,"text-md","text-slate-600"],[1,"text-sm","text-slate-500","mt-1"],[1,"grid","grid-cols-3","gap-2","text-center","my-6","w-full","border-t","border-b","border-slate-200","py-4"],[1,"text-xl","font-bold","text-slate-700"],[1,"text-xs","text-slate-500"],[1,"w-full"],[1,"text-sm","font-semibold","uppercase","text-slate-500","mb-2"],[1,"text-sm","text-slate-600","whitespace-pre-wrap","mb-3"],[1,"text-sm","text-slate-500","italic","mb-3"],[1,"w-full","bg-indigo-500","hover:bg-indigo-600","text-white","font-semibold","py-2","px-4","rounded-md","shadow-sm","transition-colors","text-sm"],[1,"md:w-2/3","p-6"],[1,"mb-4","border-b","border-slate-200"],["aria-label","Tabs",1,"flex","space-x-1","-mb-px"],[1,"whitespace-nowrap","py-3","px-4","border-b-2","font-medium","text-sm",3,"click","ngClass"],[1,"text-lg","font-semibold","text-slate-700","mb-3"],[1,"fixed","inset-0","bg-black","bg-opacity-75","flex","items-center","justify-center","z-50","p-4"],[1,"w-full","bg-indigo-500","hover:bg-indigo-600","text-white","font-semibold","py-2","px-4","rounded-md","shadow-sm","transition-colors","text-sm",3,"click"],[1,"text-slate-500","italic"],[1,"min-w-full","divide-y","divide-slate-200","text-sm"],[1,"bg-slate-50"],[1,"px-3","py-2","text-left","font-semibold","text-slate-500","uppercase","tracking-wider","cursor-pointer","hover:bg-slate-100",3,"click"],[3,"innerHTML"],[1,"px-3","py-2","text-left","font-semibold","text-slate-500","uppercase","tracking-wider"],[1,"divide-y","divide-slate-200","bg-white"],[1,"hover:bg-slate-50"],[1,"px-3","py-2"],[1,"inline-flex","items-center","px-2","py-0.5","rounded-full","text-xs","font-medium"],[1,"px-3","py-2","text-indigo-600","hover:text-indigo-800"],[3,"routerLink"],[1,"space-y-4"],[1,"p-4","bg-slate-50","rounded-lg","border","border-slate-200"],[1,"text-sm","text-slate-700","mb-1","whitespace-pre-wrap"],[1,"text-indigo-600","hover:underline",3,"routerLink","fragment"],[1,"bg-white","p-6","rounded-lg","shadow-xl","w-full","max-w-lg"],[1,"text-xl","font-semibold","text-slate-800","mb-4"],[3,"ngSubmit","formGroup"],[1,"mb-4"],["for","profileBio",1,"block","text-sm","font-medium","text-slate-700","mb-1"],["id","profileBio","formControlName","bio","rows","4",1,"w-full","p-2","border","border-slate-300","rounded-md","shadow-sm"],[1,"mb-6"],["for","profileAvatar",1,"block","text-sm","font-medium","text-slate-700","mb-1"],["type","file","id","profileAvatar","accept","image/*",1,"block","w-full","text-sm","text-slate-500","file:mr-4","file:py-2","file:px-4","file:rounded-full","file:border-0","file:text-sm","file:font-semibold","file:bg-indigo-50","file:text-indigo-700","hover:file:bg-indigo-100",3,"change"],["alt","Avatar preview",1,"mt-3","w-24","h-24","rounded-full","object-cover","border","shadow-sm",3,"src"],["alt","Current avatar","onError","this.src='https://placehold.co/96x96/E2E8F0/718096?text=No+Avatar'",1,"mt-3","w-24","h-24","rounded-full","object-cover","border","shadow-sm",3,"src"],[1,"mt-3","w-24","h-24","rounded-full","bg-slate-200","flex","items-center","justify-center","text-slate-500","text-xs","border"],[1,"flex","justify-end","space-x-3"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-slate-700","bg-slate-100","hover:bg-slate-200","rounded-md",3,"click","disabled"],["type","submit",1,"px-4","py-2","text-sm","font-medium","text-white","bg-indigo-600","hover:bg-indigo-700","rounded-md","disabled:opacity-50",3,"disabled"]],template:function(e,n){e&1&&(l(0,"div",0),u(1,Ce,2,0,"p",1)(2,ve,4,1,"div",2)(3,je,47,28)(4,$e,2,0,"p",3),o()),e&2&&(r(),c(n.isLoadingPage()?1:n.pageError()?2:n.userForView()?3:4))},dependencies:[ee,Z,$,G,ue,de,re,ae,se,_e,pe,me],styles:[".tab-content[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}"]})};var ut=[{path:"me",component:T,data:{ownProfile:!0},title:"My Profile"},{path:":username",component:T,data:{ownProfile:!1},title:"User Profile"}];export{ut as USER_PROFILE_ROUTES};
