<div class="container mx-auto p-4 bg-gray-50 min-h-screen">
  <h2 class="text-3xl font-extrabold text-gray-900 mb-6">Issues</h2>

  <div
    class="up-bar-div flex items-center justify-between bg-white p-4 rounded-lg shadow-sm mb-6 border border-gray-200"
  >
    <div class="flex items-center space-x-4 w-full">
      <button
        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors duration-200 text-sm font-medium"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4 inline-block mr-1"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01.293.707V19a2 2 0 01-2 2H5a2 2 0 01-2-2V7.293a1 1 0 01.293-.707L3 4z"
          />
        </svg>
        Filters
      </button>
      <div class="relative flex-grow">
        <input
          [(ngModel)]="searchQuery"
          placeholder="Subject or reference"
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
        />
      </div>
    </div>
    <button
      (click)="createIssue()"
      class="ml-6 px-5 py-2 bg-blue-600 text-white rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-colors duration-200 text-sm font-medium flex items-center"
    >
      New Issue
    </button>
  </div>

  <div
    class="sorting-div grid grid-cols-7 gap-2 items-center text-xs font-semibold text-gray-500 border-b border-gray-300 pb-3 mb-4 px-4"
  >
    <p
      class="col-span-1 cursor-pointer hover:text-blue-600 flex items-center"
      (click)="sortIssuesBy('type')"
    >
      TYPE
      <span *ngIf="currentSortColumn === 'type'" class="ml-1 text-blue-600">{{
        sortDirection === "asc" ? "▲" : "▼"
      }}</span>
    </p>
    <p
      class="col-span-1 cursor-pointer hover:text-blue-600 flex items-center"
      (click)="sortIssuesBy('severity')"
    >
      SEVERITY
      <span
        *ngIf="currentSortColumn === 'severity'"
        class="ml-1 text-blue-600"
        >{{ sortDirection === "asc" ? "▲" : "▼" }}</span
      >
    </p>
    <p
      class="col-span-1 cursor-pointer hover:text-blue-600 flex items-center"
      (click)="sortIssuesBy('priority')"
    >
      PRIORITY
      <span
        *ngIf="currentSortColumn === 'priority'"
        class="ml-1 text-blue-600"
        >{{ sortDirection === "asc" ? "▲" : "▼" }}</span
      >
    </p>
    <p
      class="col-span-2 cursor-pointer hover:text-blue-600 flex items-center"
      (click)="sortIssuesBy('number')"
    >
      ISSUE
      <span *ngIf="currentSortColumn === 'number'" class="ml-1 text-blue-600">{{
        sortDirection === "asc" ? "▲" : "▼"
      }}</span>
    </p>
    <p
      class="col-span-1 cursor-pointer hover:text-blue-600 flex items-center"
      (click)="sortIssuesBy('status')"
    >
      STATUS
      <span *ngIf="currentSortColumn === 'status'" class="ml-1 text-blue-600">{{
        sortDirection === "asc" ? "▲" : "▼"
      }}</span>
    </p>
    <p
      class="col-span-1 cursor-pointer hover:text-blue-600 flex items-center"
      (click)="sortIssuesBy('modified')"
    >
      MODIFIED
      <span
        *ngIf="currentSortColumn === 'modified'"
        class="ml-1 text-blue-600"
        >{{ sortDirection === "asc" ? "▲" : "▼" }}</span
      >
    </p>
    <p
      class="col-span-1 cursor-pointer hover:text-blue-600 flex items-center"
      (click)="sortIssuesBy('assignee.name')"
    >
      ASSIGN TO
      <span
        *ngIf="currentSortColumn === 'assignee.name'"
        class="ml-1 text-blue-600"
        >{{ sortDirection === "asc" ? "▲" : "▼" }}</span
      >
    </p>
  </div>

  <div
    *ngIf="!filteredIssues || filteredIssues.length === 0"
    class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md shadow-sm"
    role="alert"
  >
    <p class="font-bold">No issues found.</p>
    <p>It looks like there are no issues to display at the moment.</p>
  </div>

  <div *ngIf="issues && issues.length > 0" class="space-y-2">
    <div
      *ngFor="let issue of filteredIssues"
      class="issues-list grid grid-cols-7 gap-2 items-center bg-white rounded-lg shadow-sm px-4 py-3 border border-gray-200 hover:shadow-md transition-shadow duration-200 ease-in-out text-sm"
    >
      <div class="col-span-1 flex items-center">
        <span
          class="dot-indicator"
          [ngClass]="getDotColorClass(issue.type)"
        ></span>
        <span class="ml-2 text-gray-700">{{ issue.type }}</span>
      </div>

      <div class="col-span-1 flex items-center">
        <span
          class="dot-indicator"
          [ngClass]="getDotColorClass(issue.severity)"
        ></span>
        <span class="ml-2 text-gray-700">{{ issue.severity }}</span>
      </div>

      <div class="col-span-1 flex items-center">
        <span
          class="dot-indicator"
          [ngClass]="getDotColorClass(issue.priority)"
        ></span>
        <span class="ml-2 text-gray-700">{{ issue.priority }}</span>
      </div>

      <div class="col-span-2 flex flex-col">
        <p class="text-blue-600 font-medium hover:underline cursor-pointer">
          #{{ issue.number }} {{ issue.subject }}
        </p>
      </div>

      <div class="col-span-1">
        <span
          [ngClass]="{
            'bg-green-100 text-green-800': issue.status === 'In Progress',
            'bg-blue-100 text-blue-800': issue.status === 'Open',
            'bg-gray-100 text-gray-800': issue.status === 'Closed'
          }"
          class="px-2 py-0.5 rounded-full text-xs font-medium"
        >
          {{ issue.status }}
        </span>
      </div>

      <div class="col-span-1 text-gray-600">
        {{ issue.modified }}
      </div>

      <div class="col-span-1 flex items-center">
        <ng-container *ngIf="issue.assignee; else noAssigneePlaceholder">
          <img
            *ngIf="issue.assignee.avatar"
            [src]="issue.assignee.avatar"
            alt="Assignee Avatar"
            class="w-6 h-6 rounded-full object-cover border border-gray-300"
            onerror="this.onerror=null;this.src='https://placehold.co/24x24/cccccc/ffffff?text=NA';"
          />
          <span
            *ngIf="!issue.assignee.avatar && issue.assignee.initials"
            class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-semibold border border-gray-300"
            [ngClass]="
              issue.assignee.avatarColorClass || 'bg-gray-300 text-gray-700'
            "
          >
            {{ issue.assignee.initials }}
          </span>
          <span class="ml-2 text-gray-700">{{ issue.assignee.name }}</span>
        </ng-container>
        <ng-template #noAssigneePlaceholder>
          <img
            [src]="'https://placehold.co/24x24/e0e0e0/888888?text=?'"
            alt="Unassigned"
            class="w-6 h-6 rounded-full object-cover border border-gray-300"
          />
          <span class="text-gray-500 italic ml-2">No one</span>
        </ng-template>
      </div>
    </div>
  </div>
</div>
